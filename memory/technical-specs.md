# ê¿ˆê²° ì„œë¹„ìŠ¤ ê¸°ìˆ  ëª…ì„¸ì„œ

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ê¿ˆê²°(DreamTracer) - í†µí•© ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Mobile Client      â”‚               â”‚     Infrastructure (GCP/AWS) â”‚
â”‚    (React Native)      â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
             â”‚ REST API (HTTPS/TLS 1.3)                 â”‚
             â–¼                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load Balancer + WAF  â”‚              â”‚           Cloud Services      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                           â”‚
             â–¼                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  Object Storage â”‚â—€â”¤ LLM API  â”‚
â”‚   Python Backend API   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  (S3 / GCS)     â”‚   â”‚(Gemini)  â”‚
â”‚       (FastAPI)        â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚ (Audio Files)
             â”‚                                   â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚(DB)    â”‚(Task Queue)                   â”‚   â”‚
     â–¼        â–¼                               â”‚   â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL â”‚ â”‚  Message Broker â”‚  â”‚    AI Worker Process   â”‚
â”‚ (Cloud SQL) â”‚ â”‚ (RabbitMQ/Redis)â”‚â”€â”€â–¶â”‚       (Celery)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“± Frontend ê¸°ìˆ  ìŠ¤íƒ

### React Native ì•± êµ¬ì¡°
```
src/
â”œâ”€â”€ components/          # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ common/         # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ forms/          # í¼ ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ charts/         # ì°¨íŠ¸ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ screens/            # í™”ë©´ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ auth/           # ì¸ì¦ ê´€ë ¨ í™”ë©´
â”‚   â”œâ”€â”€ journal/        # ê¿ˆ ê¸°ë¡ í™”ë©´
â”‚   â”œâ”€â”€ insight/        # ë¶„ì„ ê²°ê³¼ í™”ë©´
â”‚   â””â”€â”€ community/      # ì»¤ë®¤ë‹ˆí‹° í™”ë©´
â”œâ”€â”€ navigation/         # ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
â”œâ”€â”€ stores/             # Zustand ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ services/           # API ì„œë¹„ìŠ¤
â”œâ”€â”€ utils/              # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â””â”€â”€ types/              # TypeScript íƒ€ì… ì •ì˜
```

### ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬
- **React Native**: 0.72+
- **TypeScript**: 5.0+
- **React Navigation**: 6.x
- **Zustand**: 4.x
- **TanStack Query**: 5.x
- **Axios**: 1.x
- **React Native Audio**: ìŒì„± ë…¹ìŒ
- **React Native Vector Icons**: ì•„ì´ì½˜
- **Lottie React Native**: ì• ë‹ˆë©”ì´ì…˜
- **React Native Calendars**: ë‹¬ë ¥
- **React Native SVG Charts**: ì°¨íŠ¸

## ğŸ–¥ï¸ Backend ê¸°ìˆ  ìŠ¤íƒ

### FastAPI í”„ë¡œì íŠ¸ êµ¬ì¡°
```
app/
â”œâ”€â”€ api/                # API ë¼ìš°í„°
â”‚   â”œâ”€â”€ v1/            # API v1 ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ auth.py    # ì¸ì¦ API
â”‚   â”‚   â”œâ”€â”€ dreams.py  # ê¿ˆ ê´€ë ¨ API
â”‚   â”‚   â”œâ”€â”€ analysis.py # ë¶„ì„ API
â”‚   â”‚   â””â”€â”€ community.py # ì»¤ë®¤ë‹ˆí‹° API
â”‚   â””â”€â”€ deps.py        # ì˜ì¡´ì„± ì£¼ì…
â”œâ”€â”€ core/              # í•µì‹¬ ì„¤ì •
â”‚   â”œâ”€â”€ config.py      # ì„¤ì • ê´€ë¦¬
â”‚   â”œâ”€â”€ security.py    # ë³´ì•ˆ ê´€ë ¨
â”‚   â””â”€â”€ database.py    # ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
â”œâ”€â”€ models/            # SQLAlchemy ëª¨ë¸
â”œâ”€â”€ schemas/           # Pydantic ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ services/          # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€ workers/           # Celery ì›Œì»¤
â””â”€â”€ utils/             # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
```

### ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬
- **FastAPI**: 0.104+
- **SQLAlchemy**: 2.0+
- **Alembic**: 1.12+
- **Celery**: 5.3+
- **Redis**: 5.0+
- **Pydantic**: 2.5+
- **Python-multipart**: íŒŒì¼ ì—…ë¡œë“œ
- **Google Cloud Storage**: íŒŒì¼ ì €ì¥
- **Firebase Admin SDK**: ì¸ì¦
- **Google Gemini API**: AI ë¶„ì„

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### PostgreSQL í…Œì´ë¸” êµ¬ì¡°
```sql
-- ì‚¬ìš©ì í…Œì´ë¸”
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE,
    auth_provider VARCHAR(50) NOT NULL,
    subscription_plan VARCHAR(20) DEFAULT 'free',
    subscription_expires_at TIMESTAMPTZ,
    notification_settings JSONB,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ê¿ˆ ê¸°ë¡ í…Œì´ë¸”
CREATE TABLE dreams (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    dream_date DATE NOT NULL,
    title VARCHAR(100),
    body_text TEXT,
    audio_file_path VARCHAR(512),
    lucidity_level SMALLINT CHECK (lucidity_level BETWEEN 1 AND 5),
    analysis_status VARCHAR(20) NOT NULL DEFAULT 'pending',
    is_shared BOOLEAN NOT NULL DEFAULT false,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- AI ë¶„ì„ ê²°ê³¼ í…Œì´ë¸”
CREATE TABLE dream_analyses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    dream_id UUID UNIQUE REFERENCES dreams(id) ON DELETE CASCADE,
    summary_text TEXT,
    keywords JSONB,
    emotional_flow_text TEXT,
    symbol_analysis JSONB,
    reflective_question TEXT,
    deja_vu_analysis JSONB,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ í…Œì´ë¸”
CREATE TABLE community_posts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    dream_id UUID REFERENCES dreams(id) ON DELETE SET NULL,
    content TEXT NOT NULL,
    tags JSONB,
    is_anonymous BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ê¿ˆ ì‹œê°í™” í…Œì´ë¸”
CREATE TABLE dream_visualizations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    dream_id UUID NOT NULL REFERENCES dreams(id) ON DELETE CASCADE,
    image_path VARCHAR(512) NOT NULL,
    art_style VARCHAR(50) NOT NULL,
    prompt_used TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
```

## ğŸ¤– AI ë¶„ì„ ì‹œìŠ¤í…œ

### ë°ìë·° ë¶„ì„ ì•Œê³ ë¦¬ì¦˜
```python
# ê¿ˆì˜ ë„¤íŠ¸ì›Œí¬ êµ¬ì¶•
def build_dream_network(user_id: str) -> nx.Graph:
    """
    ì‚¬ìš©ìì˜ ëª¨ë“  ê¿ˆì„ ë…¸ë“œë¡œ, ìœ ì‚¬ë„ë¥¼ ì—£ì§€ë¡œ í•˜ëŠ” ê·¸ë˜í”„ êµ¬ì¶•
    """
    graph = nx.Graph()
    
    # 1. ëª¨ë“  ê¿ˆì„ ë…¸ë“œë¡œ ì¶”ê°€
    dreams = get_user_dreams(user_id)
    for dream in dreams:
        graph.add_node(dream.id, type='dream', vector=dream.embedding)
    
    # 2. ìƒì§•/ê°ì •/í‚¤ì›Œë“œë¥¼ ë…¸ë“œë¡œ ì¶”ê°€
    elements = get_dream_elements(user_id)
    for element in elements:
        graph.add_node(element.id, type=element.type, vector=element.embedding)
    
    # 3. ìœ ì‚¬ë„ ê¸°ë°˜ ì—£ì§€ ìƒì„±
    for i, node1 in enumerate(graph.nodes()):
        for j, node2 in enumerate(graph.nodes()):
            if i < j:  # ì¤‘ë³µ ë°©ì§€
                similarity = cosine_similarity(
                    graph.nodes[node1]['vector'],
                    graph.nodes[node2]['vector']
                )
                if similarity > 0.75:  # ì„ê³„ê°’
                    graph.add_edge(node1, node2, weight=similarity)
    
    return graph

# Random Walk with Restart ì•Œê³ ë¦¬ì¦˜
def calculate_deja_vu_scores(new_dream_id: str, graph: nx.Graph) -> Dict[str, float]:
    """
    ìƒˆë¡œìš´ ê¿ˆê³¼ ê¸°ì¡´ ê¿ˆë“¤ ê°„ì˜ ë°ìë·° ì ìˆ˜ ê³„ì‚°
    """
    # ì „ì´ í–‰ë ¬ ê³„ì‚°
    transition_matrix = nx.adjacency_matrix(graph).todense()
    degree_matrix = np.diag(np.sum(transition_matrix, axis=1))
    transition_matrix = np.linalg.inv(degree_matrix) @ transition_matrix
    
    # ì´ˆê¸° í™•ë¥  ë²¡í„° (ìƒˆë¡œìš´ ê¿ˆì— ì§‘ì¤‘)
    initial_vector = np.zeros(graph.number_of_nodes())
    node_list = list(graph.nodes())
    new_dream_index = node_list.index(new_dream_id)
    initial_vector[new_dream_index] = 1.0
    
    # RWR ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰
    alpha = 0.15  # ì¬ì‹œì‘ í™•ë¥ 
    current_vector = initial_vector.copy()
    
    for _ in range(100):  # ìˆ˜ë ´ê¹Œì§€ ë°˜ë³µ
        next_vector = (1 - alpha) * transition_matrix.T @ current_vector + alpha * initial_vector
        if np.allclose(current_vector, next_vector, atol=1e-6):
            break
        current_vector = next_vector
    
    # ë°ìë·° ì ìˆ˜ ì¶”ì¶œ (ê¿ˆ ë…¸ë“œë“¤ë§Œ)
    deja_vu_scores = {}
    for i, node in enumerate(node_list):
        if graph.nodes[node]['type'] == 'dream' and node != new_dream_id:
            deja_vu_scores[node] = float(current_vector[i])
    
    return deja_vu_scores
```

## ğŸ”’ ë³´ì•ˆ ë° ì¸ì¦

### JWT í† í° ê´€ë¦¬
```python
# í† í° ìƒì„±
def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt

# í† í° ê²€ì¦
def verify_token(token: str):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        user_id: str = payload.get("sub")
        if user_id is None:
            raise HTTPException(status_code=401, detail="Invalid token")
        return user_id
    except JWTError:
        raise HTTPException(status_code=401, detail="Invalid token")
```

### ë°ì´í„° ì•”í˜¸í™”
```python
# ë¯¼ê°í•œ ë°ì´í„° ì•”í˜¸í™”
from cryptography.fernet import Fernet

def encrypt_sensitive_data(data: str) -> str:
    key = Fernet.generate_key()
    f = Fernet(key)
    encrypted_data = f.encrypt(data.encode())
    return encrypted_data.decode()

def decrypt_sensitive_data(encrypted_data: str, key: bytes) -> str:
    f = Fernet(key)
    decrypted_data = f.decrypt(encrypted_data.encode())
    return decrypted_data.decode()
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```python
# API ì‘ë‹µ ì‹œê°„ ëª¨ë‹ˆí„°ë§
import time
from functools import wraps

def monitor_performance(func):
    @wraps(func)
    async def wrapper(*args, **kwargs):
        start_time = time.time()
        result = await func(*args, **kwargs)
        end_time = time.time()
        
        # Prometheus ë©”íŠ¸ë¦­ ê¸°ë¡
        api_duration.labels(
            endpoint=func.__name__,
            method=request.method
        ).observe(end_time - start_time)
        
        return result
    return wrapper

# ì—ëŸ¬ ì¶”ì 
import sentry_sdk

sentry_sdk.init(
    dsn="YOUR_SENTRY_DSN",
    traces_sample_rate=1.0,
    profiles_sample_rate=1.0,
)
```

## ğŸš€ ë°°í¬ ë° CI/CD

### Docker ì„¤ì •
```dockerfile
# Backend Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### GitHub Actions ì›Œí¬í”Œë¡œìš°
```yaml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run tests
        run: pytest

  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to GCP
        run: |
          gcloud run deploy dreamtracer-api \
            --source . \
            --platform managed \
            --region asia-northeast1 \
            --allow-unauthenticated
```
